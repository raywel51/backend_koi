<!DOCTYPE html>
<html>
  <head>
    <title>VISITOR | Updater | DIR</title>
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="https://www.buu.ac.th/wp-content/uploads/2023/04/site_logo_512-300x300.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://www.buu.ac.th/wp-content/uploads/2023/04/site_logo_512-300x300.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://www.buu.ac.th/wp-content/uploads/2023/04/site_logo_512-300x300.png"
    />
    <link rel="manifest" href="/ico/site.webmanifest" />
    <link rel="mask-icon" href="/ico/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css"
    />
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              clifford: "#da373d",
            },
          },
        },
      };

      document.addEventListener("DOMContentLoaded", function () {
        const menuButton = document.querySelector(
          '[data-collapse-toggle="navbar-sticky"]'
        );
        const mobileMenu = document.getElementById("navbar-sticky"); // Assuming 'navbar-sticky' is the ID of your mobile menu

        if (menuButton && mobileMenu) {
          menuButton.addEventListener("click", function () {
            mobileMenu.classList.toggle("hidden");
          });
        }
      });
    </script>
    <meta name="robots" content="noindex" />
    <style>
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        margin: 0;
      }

      main {
        flex: 1;
      }

      .centered {
        text-align: center;
      }
      @media (max-width: 768px) {
        .footer-container {
          display: none;
        }
        .text-center-on-small {
          display: none;
        }
      }

      body {
        margin: 0;
        padding: 0;
        min-height: 100vh; /* Ensure the body takes up at least the full viewport height */
        display: flex;
        flex-direction: column;
      }

      #404 {
        /* Add your 404 content styles here */
        flex: 1; /* This makes the 404 content expand to fill the remaining space */
      }

      #footer-page {
        position: fixed;
        bottom: 0;
        width: 100%;
        /* Add your footer styles here */
      }
      .btn {
        height: 30px; /* Adjust the height value as needed */
        font-size: 10px;
        /* Add any other styles you want for the button */
      }
    </style>
  </head>

  <div purpose="page-wrap">
    <header class="bg-gray-800 sm:flex sm:justify-between p-4">
      <nav
        class="bg-white dark:bg-gray-900 fixed w-full z-20 top-0 left-0 border-b border-gray-200 dark:border-gray-600"
      >
        <div
          class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"
        >
          <a href="/" class="flex items-center">
            <span
              class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white"
              ><img
                class="mx-auto w-16"
                src="https://www.buu.ac.th/wp-content/uploads/2023/04/logo.png"
                alt="Your Company"
            /></span>
          </a>
          <div class="flex md:order-2">
            <button
              onclick="logout()"
              type="button"
              class="flex w-full justify-center rounded-md bg-yellow-400 px-8 py-1.5 text-sm font-semibold leading-6 text-black shadow-sm hover:bg-yellow-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-yellow-600"
            >
              <%= username %>
            </button>
            <button
              data-collapse-toggle="navbar-sticky"
              type="button"
              class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
              aria-controls="navbar-sticky"
              aria-expanded="false"
            >
              <span class="sr-only">Open main menu</span>
              <svg
                class="w-5 h-5"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 17 14"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M1 1h15M1 7h15M1 13h15"
                />
              </svg>
            </button>
          </div>
          <div
            class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1"
            id="navbar-sticky"
          >
            <ul
              class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700"
            >
              <li>
                <a
                  href="/main"
                  class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
                  aria-current="page"
                  >หน้าแรก</a
                >
              </li>
              <li>
                <a
                  href="/check-in"
                  class="block py-2 pl-3 pr-4 text-black bg-yellow-400 rounded md:bg-transparent md:text-blue-700 md:p-0 md:dark:text-blue-500"
                  >ลงทะเบียนเข้า</a
                >
              </li>
              <li>
                <a
                  href="/check-guest"
                  class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
                  >เช็กการลงทะเบียน</a
                >
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <br />
    </header>

    <nav class="bg-grey-light p-3 rounded font-sans w-full m-4">
      <ol class="list-reset flex text-grey-dark">
        <li><a href="/" class="text-blue font-bold">Home</a></li>
        <li><span class="mx-2">/</span></li>
        <li>visitor register</li>
      </ol>
    </nav>

    <div class="lg:px-8">
      <h1 class="text-2xl font-bold mb-5">Visitor Information Form</h1>
    </div>

    <div id="main">
      <div class="container mx-auto p-5">
        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
          <div class="mb-4">
            <label
              class="block text-gray-700 text-sm font-bold mb-2"
              for="visitor_name"
              >Visitor Name:</label
            >
            <input
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="visitor_name"
              name="visitor_name"
              type="text"
              placeholder="Visitor Name"
            />
          </div>
          <div class="mb-4">
            <label
              class="block text-gray-700 text-sm font-bold mb-2"
              for="contact"
              >Contact:</label
            >
            <select
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="contact"
              name="contact"
            >
              <% contactList.forEach(function(it) { %>
              <option value="<%= it.id %>"><%= it.contact_about %></option>
              <% }); %>
            </select>
          </div>

          <div class="mb-4">
            <label
              class="block text-gray-700 text-sm font-bold mb-2"
              for="contact"
              >Location:</label
            >
            <select
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="location"
              name="contact"
            >
              <% locationList.forEach(function(it) { %>
              <option value="<%= it.id %>"><%= it.location_en %></option>
              <% }); %>
            </select>
          </div>

          <div class="mb-4">
            <label
              class="block text-gray-700 text-sm font-bold mb-2"
              for="mobile_phone"
              >Mobile Phone:</label
            >
            <input
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="mobile_phone"
              name="mobile_phone"
              type="text"
              placeholder="Mobile Phone"
            />
          </div>
          <div class="mb-4">
            <label
              class="block text-gray-700 text-sm font-bold mb-2"
              for="email"
              >Email:</label
            >
            <input
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="email"
              name="email"
              type="email"
              placeholder="Email"
            />
          </div>
          <div class="mb-4">
            <label
              class="block text-gray-700 text-sm font-bold mb-2"
              for="plate"
              >Plate:</label
            >
            <input
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="plate"
              name="plate"
              type="text"
              placeholder="Plate"
            />
          </div>
          <div class="mb-4">
            <label
              class="block text-gray-700 text-sm font-bold mb-2"
              for="final_time"
              >Start Time:</label
            >
            <input
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="start_time"
              name="start_time"
              type="datetime-local"
              placeholder="Start Time"
            />
          </div>
          <div class="mb-4">
            <label
              class="block text-gray-700 text-sm font-bold mb-2"
              for="final_time"
              >Final Time:</label
            >
            <input
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
              id="final_time"
              name="final_time"
              type="datetime-local"
              placeholder="Final Time"
            />
          </div>
          <div class="flex items-center justify-between">
            <button
              class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
              onclick="sentApi()"
            >
              Submit
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer
      class="bg-light py-4 flex justify-between flex-row-reverse"
      purpose="page-footer"
    >
      <small
        purpose="footer-page"
        class="text-gray-600 text-center-on-small sm:text-right mt-2 sm:mt-0"
      >
        Copyright &copy; 2066
        <a target="_blank" href="https://www.buu.ac.th" class="text-blue-600"
          >มหาวิทยาลัยบูรพา</a
        >.<br class="block sm:hidden" />All rights reserved.
      </small>
    </footer>
  </div>
</html>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="@sweetalert2/theme-material-ui/material-ui.css" />
<script>
  const visitorNameField = document.getElementById("visitor_name");
  const contactField = document.getElementById("contact");
  const locationField = document.getElementById("location");
  const mobilePhoneField = document.getElementById("mobile_phone");
  const emailField = document.getElementById("email");
  const plateField = document.getElementById("plate");
  const startTimeField = document.getElementById("start_time");
  const finalTimeField = document.getElementById("final_time");
  const dialog = document.getElementById("exampleModal");

  const logout = () => {
    Swal.fire({
      title: "คุณแน่ใจหรือไม่?",
      text: "คุณจะไม่สามารถย้อนกลับได้!",
      showCancelButton: true,
      buttonsStyling: false,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "ใช่, ออกจากระบบ!",
      customClass: {
        confirmButton:
          "flex justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",
        cancelButton:
          "flex justify-center rounded-md bg-red-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600 ml-2",
      },
    }).then((result) => {
      if (result.isConfirmed) {
        // Remove the cookie (assuming you have a function named removeCookie)
        document.cookie = `token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
        // Redirect to the login page
        window.location.href = "login";
      }
    });
  };

  const sentApi = () => {
    const formData = {
      visitor_name: visitorNameField.value,
      contact: contactField.options[contactField.selectedIndex].text,
      place: locationField.options[locationField.selectedIndex].text,
      mobile_phone: mobilePhoneField.value,
      email: emailField.value,
      plate: plateField.value,
      start_time: startTimeField.value,
      final_time: finalTimeField.value,
    };

    axios
      .post("/api/v1/visitor/check-in", formData, {
        headers: {
          Authorization: document.cookie,
        },
      })
      .then(function (response) {
        console.log("Form data submitted successfully:", response);

        Swal.fire({
          html: `
                        <div class="my-4 center" style="text-align: center;">
                            <img src="${response.data.qr_image}" alt="QR Code" style="display: block; margin: 0 auto;">
                            <p>${response.data.message}</p>
                        </div>
                        
                        <button onclick="closeSwal()" class="flex w-full justify-center rounded-md bg-yellow-400 px-3 py-1.5 text-sm font-semibold leading-6 text-black shadow-sm hover:bg-yellow-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-yellow-600">ตกลง</button>
                        `,
          showConfirmButton: false,
        }).then((result) => {
          if (result.dismiss === Swal.DismissReason.close) {
            closeSwal();
          }
        });
      })
      .catch(function (error) {
        if (error.response && error.response.data) {
          const errorMessage = error.response.data.message;
          Swal.fire({
            html: `
                            <div class="my-4">
                                <p>${errorMessage}</p>
                            </div>
                            <button onclick="Swal.close()" class="flex w-full justify-center rounded-md bg-yellow-400 px-3 py-1.5 text-sm font-semibold leading-6 text-black shadow-sm hover:bg-yellow-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-yellow-600">ตกลง</button>
                        `,
            showConfirmButton: false,
          });
        } else {
          alert("An error occurred!");
        }
      });
  };

  const closeSwal = () => {
    Swal.close();
    clearForm();
  };

  const clearForm = () => {
    visitorNameField.value = "";
    contactField.value = "";
    locationField.value = "";
    mobilePhoneField.value = "";
    emailField.value = "";
    plateField.value = "";
    startTimeField.value = "";
    finalTimeField.value = "";
  };
</script>
